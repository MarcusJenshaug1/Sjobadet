const m="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let d=(t=21)=>{let e="",a=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)e+=m[a[t]&63];return e};const c="sjobadet_session",r="sjobadet_consent";const l=()=>{const t=document.cookie.split("; ").find(e=>e.startsWith(`${r}=`));if(!t)return null;try{const e=JSON.parse(decodeURIComponent(t.split("=")[1]));return e.version!=="v1"?null:e}catch{return null}},p=async t=>{const e={essential:!0,analysis:t.analysis??!1,marketing:t.marketing??!1,functional:t.functional??!1,version:"v1",timestamp:Date.now()},a=encodeURIComponent(JSON.stringify(e));if(document.cookie=`${r}=${a}; path=/; max-age=31536000; samesite=lax; secure`,!window.SJOBADET_IS_ADMIN)try{let n="custom";e.analysis&&e.functional&&e.marketing?n="accepted":!e.analysis&&!e.functional&&!e.marketing&&(n="declined");let s=null;e.analysis&&(s=i().id),await fetch("/api/privacy/consent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({consentVersion:"v1",essential:e.essential,analysis:e.analysis,functional:e.functional,marketing:e.marketing,choice:n,source:"banner",sessionId:s}),keepalive:!0})}catch{}return window.dispatchEvent(new CustomEvent("consentChange",{detail:e})),e},i=()=>{if(!l()?.analysis)return{id:"",utmSource:null,utmMedium:null,utmCampaign:null,referrer:null};const e=document.cookie.split("; ").find(o=>o.startsWith(`${c}=`));if(e)try{return JSON.parse(decodeURIComponent(e.split("=")[1]))}catch{}const a=new URLSearchParams(window.location.search),n={id:d(),utmSource:a.get("utm_source"),utmMedium:a.get("utm_medium"),utmCampaign:a.get("utm_campaign"),referrer:document.referrer||null},s=encodeURIComponent(JSON.stringify(n));return document.cookie=`${c}=${s}; path=/; max-age=86400; samesite=lax; secure`,n};async function u(t,e){if(window.SJOBADET_IS_ADMIN||!l()?.analysis)return;const n=i(),s=n.id,o=e.path||window.location.pathname;try{await fetch("/api/analytics/ingest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:s,type:t,eventName:e.eventName,path:o,payload:e.payload,metadata:{utmSource:n.utmSource,utmMedium:n.utmMedium,utmCampaign:n.utmCampaign}}),keepalive:!0})}catch{}}const y=t=>u("pageview",{path:t}),f=(t,e)=>u("event",{eventName:t,payload:e});async function S(t){if(!window.SJOBADET_IS_ADMIN)try{const e=i();await fetch("/api/analytics/ingest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e.id,type:"event",eventName:"consent_choice",payload:{choice:t},path:window.location.pathname,metadata:{}}),keepalive:!0})}catch{}}export{S as a,y as b,l as g,p as s,f as t};
