import{a,j as e}from"./iframe-BeGkvnHr.js";import{B as ce}from"./BookingModal-BbSyfe_L.js";import{a as de,g as X,f as ae}from"./availability-utils-DC47xJm5.js";import"./preload-helper-D1UD9lgW.js";import"./index-Dn476rUD.js";const ue="_container_44q4f_1",pe="_header_44q4f_17",fe="_titleWrapper_44q4f_51",me="_title_44q4f_51",ge="_badge_44q4f_77",ye="_dot_44q4f_99",xe="_dotRefreshing_44q4f_115",he="_badgeText_44q4f_183",_e="_updatedAt_44q4f_199",be="_toggleButton_44q4f_211",ve="_toggleActive_44q4f_243",ke="_nextSlot_44q4f_255",De="_nextDot_44q4f_277",je="_nextText_44q4f_291",Se="_nextTime_44q4f_303",Te="_grid_44q4f_311",Ne="_slotCard_44q4f_335",Ce="_slotCardClickable_44q4f_359",Ae="_slotTime_44q4f_383",we="_slotCapacity_44q4f_395",qe="_stateFull_44q4f_409",Ie="_stateFew_44q4f_431",Be="_stateMany_44q4f_465",Fe="_empty_44q4f_499",$e="_emptyText_44q4f_517",t={container:ue,header:pe,titleWrapper:fe,title:me,badge:ge,dot:ye,dotRefreshing:xe,badgeText:he,updatedAt:_e,toggleButton:be,toggleActive:ve,nextSlot:ke,nextDot:De,nextText:je,nextTime:Se,grid:Te,slotCard:Ne,slotCardClickable:Ce,slotTime:Ae,slotCapacity:we,stateFull:qe,stateFew:Ie,stateMany:Be,empty:Fe,emptyText:$e};var Ee={};const K={};function se({saunaId:s,bookingUrlDropin:O,capacityDropin:h=10,isAdmin:W=!1,showAvailability:u=!0}){const[_,b]=a.useState(K[s]||null),[M,r]=a.useState(!K[s]),[v,k]=a.useState(!1),[C,A]=a.useState(!1),[w,z]=a.useState(!0),[G,Y]=a.useState(null),q=a.useRef(!1),[re,ie]=a.useState(!1),I=a.useRef(null),p=a.useRef(!1),f=a.useRef(null);a.useEffect(()=>(ie(!0),p.current=!0,()=>{p.current=!1,I.current?.abort(),f.current&&(clearTimeout(f.current),f.current=null)}),[]);const S=a.useCallback(async(n=!1,l=!1)=>{if(u===!1){r(!1),f.current&&(clearTimeout(f.current),f.current=null);return}p.current&&A(!1),l||(q.current?r(!1):r(!0)),l&&k(!0),I.current?.abort();const D=new AbortController;I.current=D;try{const i=Ee.NEXT_PUBLIC_AVAILABILITY_API_URL,T=i?`${i}?saunaId=${s}${n?"&force=true":""}`:`/api/availability/today?saunaId=${s}${n?"&force=true":""}`,N=await fetch(T,{cache:"no-store",signal:D.signal});if(!N.ok)throw new Error("Failed to fetch");const c=await N.json();if(c.isInitial&&!q.current)p.current&&r(!0);else{const B=new Date,le=B.getHours()*60+B.getMinutes(),te=(g=0)=>{const P=new Date(B);P.setDate(B.getDate()+g);const y=new Intl.DateTimeFormat("sv-SE",{timeZone:"Europe/Oslo",year:"numeric",month:"2-digit",day:"2-digit"}).formatToParts(P),Z=y.find(x=>x.type==="year")?.value??"",E=y.find(x=>x.type==="month")?.value??"",V=y.find(x=>x.type==="day")?.value??"";return`${Z}-${E}-${V}`},j=te(0),ne=te(1);let F=[],$=j;if(c.days){const g=Object.keys(c.days).filter(Boolean).sort(),P=d=>{if(!d)return null;const[o,R]=d.split(/[:.]/).map(Number);return!Number.isFinite(o)||!Number.isFinite(R)?null:o*60+R},y=d=>c.days?.[d]||[],Z=d=>d.some(o=>{if(o.availableSpots<=0)return!1;const R=P(o.to||o.from);return R===null?!0:R>le}),E=y(j),V=y(ne),x=Z(E);if(!x&&V.length>0)F=V,$=ne;else if(x)F=E,$=j;else{const d=g.find(o=>o>j&&y(o).length>0)||g.find(o=>o>j);d?(F=y(d),$=d):g.includes(j)&&(F=E,$=j)}}if(p.current){const g={...c,displaySlots:F,displayDate:$};b(g),K[s]=g,q.current=!0,r(!1)}}p.current&&A(!1)}catch(i){if(i instanceof Error&&i.name==="AbortError")return;p.current&&!q.current&&A(!0),p.current&&r(!1)}finally{I.current===D&&(I.current=null),p.current&&k(!1),f.current&&(clearTimeout(f.current),f.current=null)}},[s,u]);if(a.useEffect(()=>{if(u===!1){r(!1);return}const n=K[s];q.current=!!n,b(n||null),A(!1),r(!n),S();const l=setInterval(()=>S(!1,!0),6e4);return()=>clearInterval(l)},[s,u,S]),!u)return null;if(M&&!_&&!C)return e.jsx("div",{className:t.container,children:e.jsx("div",{className:t.grid,children:[1,2,3,4,5,6].map(n=>e.jsx("div",{className:t.slotCard,style:{backgroundColor:"#f7fafc",minHeight:"50px",animation:"refreshPulse 2s infinite"}},n))})});if(C&&!_)return e.jsx("div",{className:t.container,children:e.jsxs("div",{className:t.error,children:["Klarte ikke hente ledighet.",e.jsx("button",{onClick:()=>S(),className:t.retryButton,children:"Prøv igjen"})]})});const m=_||{timestamp:null,displayDate:""},J=new Intl.DateTimeFormat("sv-SE",{timeZone:"Europe/Oslo",year:"numeric",month:"2-digit",day:"2-digit"}).format(new Date),Q=(()=>{const n=_?.displaySlots||[];if(!w)return n;const l=new Date,D=l.getHours()*60+l.getMinutes();return n.filter(i=>{if(i.availableSpots<=0)return!1;if(m.displayDate===J){const T=i.from.split(/[:.]/).map(Number);return T[0]*60+T[1]>D+15}return!0})})(),L=de(_?.days,new Date,"Europe/Oslo"),oe=(()=>{const n=m.displayDate;return n?`Drop-in ledighet ${X(n,new Date,"Europe/Oslo")}`:"Drop-in ledighet"})(),ee=m.displayDate&&X(m.displayDate,new Date,"Europe/Oslo")!=="i dag"?ae(m.displayDate):null;return e.jsxs("div",{className:t.container,children:[e.jsxs("div",{className:t.header,children:[e.jsxs("div",{children:[e.jsxs("div",{className:t.titleWrapper,children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("h3",{className:t.title,children:oe}),ee&&e.jsx("span",{style:{fontSize:"0.8rem",color:"#718096",marginTop:"-4px",marginBottom:"4px"},children:ee})]}),e.jsxs("div",{className:t.badge,title:"Denne hentes automatisk hvert minutt",children:[e.jsx("div",{className:v?t.dotRefreshing:t.dot}),e.jsx("span",{className:t.badgeText,children:v?"Henter...":"Live-status"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[re&&m.timestamp&&e.jsxs("p",{className:t.updatedAt,children:["Oppdatert ",new Date(m.timestamp).toLocaleTimeString("no-NO",{hour:"2-digit",minute:"2-digit"})]}),W&&e.jsx("button",{onClick:()=>S(!0,!0),disabled:v,title:"Denne knappen er kun synlig for deg som er admin",style:{fontSize:"10px",padding:"2px 6px",background:"#edf2f7",border:"1px solid #cbd5e0",borderRadius:"4px",cursor:"pointer",opacity:v?.5:1},children:v?"Henter...":"DEBUG: Force Scrape"})]})]}),e.jsx("div",{className:t.actions,children:e.jsx("button",{className:`${t.toggleButton} ${w?t.toggleActive:""}`,onClick:()=>z(n=>!n),children:w?"Vis alle timer":"Vis bare ledige"})})]}),L?e.jsxs("div",{className:t.nextSlot,children:[e.jsx("div",{className:t.nextDot}),e.jsxs("span",{className:t.nextText,children:["Neste ledige: ",e.jsx("span",{className:t.nextTime,children:L.slot.from}),X(L.date,new Date)!=="i dag"&&e.jsxs("span",{style:{marginLeft:"4px",opacity:.8},children:["(",ae(L.date),")"]})]})]}):e.jsx("div",{className:t.nextSlot,children:e.jsx("span",{className:t.nextText,children:"Ingen ledige timer neste 7 dager"})}),e.jsx("div",{className:t.grid,children:Q.length>0?Q.map((n,l)=>{const D=m.displayDate===J,i=new Date,T=i.getHours()*60+i.getMinutes();let N=!1;if(D){const c=n.from.split(/[:.]/).map(Number);c[0]*60+c[1]<T&&(N=!0)}return e.jsx(Re,{slot:n,totalCapacity:h,baseBookingUrl:O,displayDate:m.displayDate,isPast:N,onOpenBooking:c=>Y(c)},l)}):e.jsxs("div",{className:t.empty,children:[e.jsx("p",{className:t.emptyText,children:"Ingen ledige timer funnet akkurat nå"}),e.jsx("button",{onClick:()=>S(!0),className:t.retryButton,style:{marginTop:"0.5rem"},children:"Oppdater status"})]})}),e.jsx(ce,{open:!!G,url:G||"",onClose:()=>Y(null),title:"Booking"})]})}function Re({slot:s,totalCapacity:O,baseBookingUrl:h,displayDate:W,isPast:u=!1,onOpenBooking:_}){const b=s.availableSpots===0,M=s.availableSpots;let r=t.stateMany;const v=O>0?M/O:0;b||u?r=t.stateFull:v<=.7&&(r=t.stateFew);let k="";if(h&&h.includes("periode.no")&&!b&&!u){const w=s.from,z=W||new Date().toISOString().split("T")[0];k=`${h.endsWith("/")?h.slice(0,-1):h}/${z}/${w}`}const C=e.jsxs(e.Fragment,{children:[e.jsx("span",{className:t.slotTime,children:s.from}),e.jsx("span",{className:t.slotCapacity,children:b?"Fullt":`${M} plasser`})]});return!!k&&!b&&!u&&k?e.jsx("button",{type:"button",className:`${t.slotCard} ${t.slotCardClickable} ${r}`,onClick:()=>_(k),children:C}):e.jsx("div",{className:`${t.slotCard} ${r}`,children:C})}se.__docgenInfo={description:"",methods:[],displayName:"SaunaAvailability",props:{saunaId:{required:!0,tsType:{name:"string"},description:""},bookingUrlDropin:{required:!1,tsType:{name:"union",raw:"string | null",elements:[{name:"string"},{name:"null"}]},description:""},capacityDropin:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"10",computed:!1}},isAdmin:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},showAvailability:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}}}};const Oe=`# SaunaAvailability\r
\r
Kort beskrivelse: Viser ledige tider og kapasitet for drop-in.\r
\r
## Bruk\r
- Bruk på badstuesider for å vise tilgjengelighet.\r
\r
## Ikke bruk\r
- Ikke bruk når API ikke er tilgjengelig.\r
\r
## Retningslinjer for innhold\r
- Vis kun relevante tider for i dag/kommende dag.\r
\r
## Props (kort)\r
- \`saunaId\`: ID for badstuen.\r
- \`bookingUrlDropin\`: URL for drop-in booking.\r
- \`capacityDropin\`: Kapasitet for drop-in.\r
- \`isAdmin\`: Admin-visning.\r
- \`showAvailability\`: Skjul/vis tilgjengelighet.\r
\r
## Eksempler\r
\`\`\`tsx\r
<SaunaAvailability saunaId="1" capacityDropin={10} />\r
\`\`\`\r
\r
## Tilgjengelighet\r
- Knappetekst og tidsinformasjon er tekstlig.\r
\r
## Vedlikehold/Notater\r
- Henter data fra API og cacher i minne.\r
\r
## Gjør\r
- Vis tilgjengelighet når API er tilgjengelig.\r
- Bruk \`capacityDropin\` for riktig status.\r
\r
## Unngå\r
- Ikke vis tomme lister uten forklaring.\r
- Ikke bruk uten \`saunaId\`.\r
`,We={title:"Komponenter/Badstue/SaunaAvailability",component:se,tags:["autodocs"],parameters:{docs:{description:{component:Oe}}},argTypes:{saunaId:{control:"text",description:"ID for badstuen som skal hentes."},capacityDropin:{control:"number",description:"Kapasitet for drop-in."},showAvailability:{control:"boolean",description:"Skjul/vis komponenten."}},args:{saunaId:"demo",capacityDropin:10,showAvailability:!0}},U={},H={args:{showAvailability:!1}};U.parameters={...U.parameters,docs:{...U.parameters?.docs,source:{originalSource:"{}",...U.parameters?.docs?.source}}};H.parameters={...H.parameters,docs:{...H.parameters?.docs,source:{originalSource:`{
  args: {
    showAvailability: false
  }
}`,...H.parameters?.docs?.source}}};const ze=["Standard","Skjult"];export{H as Skjult,U as Standard,ze as __namedExportsOrder,We as default};
